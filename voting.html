<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <title>Kazjistan Election Results</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    h1, h2 {
      color: #2c3e50;
      text-align: center;
    }
    .results-container {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .elected {
      color: #27ae60;
      font-weight: bold;
    }
    .eliminated {
      color: #e74c3c;
      text-decoration: line-through;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #3498db;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    .round {
      margin-bottom: 30px;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 5px;
      background-color: white;
    }
    .round h3 {
      margin-top: 0;
      color: #3498db;
    }
    .action {
      font-weight: bold;
      margin: 10px 0;
      padding: 8px;
      background-color: #f8f9fa;
      border-left: 4px solid #3498db;
    }
  </style>
</head>
<body>
  <h1>Parliament of Kazjistan Election Results</h1>
  
  <div class="results-container">
    <h2>Final Results</h2>
    <p>Total ballots cast: <span id="total-ballots"></span></p>
    <p>Droop quota: <span id="quota"></span></p>
    
    <h3>Elected Candidates:</h3>
    <ul id="elected-list"></ul>
    
    <h3>Final Vote Counts:</h3>
    <table id="final-counts">
      <thead>
        <tr>
          <th>Candidate</th>
          <th>Votes</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  
  <div class="results-container">
    <h2>Counting Rounds</h2>
    <div id="rounds-container"></div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      google.script.run.withSuccessHandler(displayResults).getElectionResults();
    });
    
    function displayResults(results) {
      // Display basic info
      document.getElementById('total-ballots').textContent = results.totalBallots;
      document.getElementById('quota').textContent = results.quota;
      
      // Display elected candidates
      const electedList = document.getElementById('elected-list');
      results.elected.forEach(candidate => {
        const li = document.createElement('li');
        li.textContent = candidate;
        li.className = 'elected';
        electedList.appendChild(li);
      });
      
      // Display final counts
      const finalCountsBody = document.querySelector('#final-counts tbody');
      for (const [candidate, data] of Object.entries(results.finalCounts)) {
        const row = document.createElement('tr');
        
        const nameCell = document.createElement('td');
        nameCell.textContent = candidate;
        row.appendChild(nameCell);
        
        const votesCell = document.createElement('td');
        votesCell.textContent = data.votes;
        row.appendChild(votesCell);
        
        const statusCell = document.createElement('td');
        statusCell.textContent = data.status;
        if (data.status === 'elected') {
          statusCell.className = 'elected';
        } else if (data.status === 'eliminated') {
          statusCell.className = 'eliminated';
        }
        row.appendChild(statusCell);
        
        finalCountsBody.appendChild(row);
      }
      
      // Display counting rounds
      const roundsContainer = document.getElementById('rounds-container');
      results.rounds.forEach(round => {
        const roundDiv = document.createElement('div');
        roundDiv.className = 'round';
        
        const heading = document.createElement('h3');
        heading.textContent = `Round ${round.number}`;
        roundDiv.appendChild(heading);
        
        const actionDiv = document.createElement('div');
        actionDiv.className = 'action';
        actionDiv.textContent = round.action;
        roundDiv.appendChild(actionDiv);
        
        const table = document.createElement('table');
        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');
        
        const th1 = document.createElement('th');
        th1.textContent = 'Candidate';
        headerRow.appendChild(th1);
        
        const th2 = document.createElement('th');
        th2.textContent = 'Votes';
        headerRow.appendChild(th2);
        
        thead.appendChild(headerRow);
        table.appendChild(thead);
        
        const tbody = document.createElement('tbody');
        for (const [candidate, votes] of Object.entries(round.totals)) {
          const row = document.createElement('tr');
          
          const nameCell = document.createElement('td');
          nameCell.textContent = candidate;
          row.appendChild(nameCell);
          
          const votesCell = document.createElement('td');
          votesCell.textContent = votes;
          row.appendChild(votesCell);
          
          tbody.appendChild(row);
        }
        table.appendChild(tbody);
        roundDiv.appendChild(table);
        
        roundsContainer.appendChild(roundDiv);
      });
    }
  </script>
</body>
</html>
