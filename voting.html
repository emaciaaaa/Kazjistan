<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>11 July 2025 By-election - People's Republic of Kazjistan</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Noto+Serif:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Previous CSS styles remain the same */
        /* Add these new styles for the referendum section */
        .referendum-container {
            margin: 30px 0;
            border-top: 2px solid var(--secondary-color);
            padding-top: 20px;
        }
        
        .referendum-question {
            margin-bottom: 25px;
            padding: 20px;
            background-color: var(--accent-color);
            border-radius: 5px;
            border-left: 4px solid var(--primary-color);
        }
        
        .referendum-title {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .referendum-text {
            margin-bottom: 15px;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .referendum-instruction {
            font-style: italic;
            color: var(--light-text);
            margin-bottom: 10px;
        }
        
        .referendum-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .referendum-input input {
            padding: 8px 12px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 150px;
        }
        
        .referendum-input label {
            font-weight: 500;
        }
        
        /* Rest of your existing CSS remains unchanged */
    </style>
</head>
<body>
    <!-- Header, Hero sections remain the same -->
    
    <main class="container">
        <div class="ballot-container">
            <h2 class="section-title">By-election Ballot</h2>
            
            <div class="instructions">
                Number at least 8 boxes in order of preference (1 to 8+). Additional preferences are optional.
            </div>
            
            <!-- Parties container with candidates remains the same -->
            
            <!-- New Referendum Section -->
            <div class="referendum-container">
                <h3 class="section-title">Referendum Questions</h3>
                
                <div class="referendum-question">
                    <div class="referendum-title">Referendum Proposition 1</div>
                    <div class="referendum-text">
                        Do you agree with inserting the following article after twenty-eight, thereby shifting each following article by one digit?
                        <br><br>
                        <em>Article Twenty-Nine: The Judiciary shall not unduly delay proceedings without just cause, and must adjudicate cases in a timely manner. Justices found to partake in deliberate or unreasonable postponements of proceedings are to be removed by Parliament.</em>
                    </div>
                    <div class="referendum-instruction">yes or no</div>
                    <div class="referendum-input">
                        <label>Your vote (yes/no):</label>
                        <input type="text" id="referendum-1" required pattern="^(yes|no)$" title="Please enter either 'yes' or 'no'">
                    </div>
                </div>
                
                <div class="referendum-question">
                    <div class="referendum-title">Referendum Proposition 2</div>
                    <div class="referendum-text">
                        Do you agree with inserting the following article after fifty-seven, thereby shifting each following article by one digit?
                        <br><br>
                        <em>Fifty-Eight: The government shall not establish, impose, or enforce any centralised economic, monetary, or financial system, nor shall it create institutions, regulations, or mechanisms that effectively constitute such a system, whether in whole or in part, directly or indirectly. No government or citizen shall institute financial, monetary, currency, or economic systems within Kazjistan, including central banks, private financial institutions, or external organizations purporting to act on behalf of the Kazji state. This prohibition extends to all claims of state endorsement, de facto financial structures, or circumvention through external entities.</em>
                    </div>
                    <div class="referendum-instruction">yes or no</div>
                    <div class="referendum-input">
                        <label>Your vote (yes/no):</label>
                        <input type="text" id="referendum-2" required pattern="^(yes|no)$" title="Please enter either 'yes' or 'no'">
                    </div>
                </div>
            </div>

            <!-- Username Input -->
            <div class="username-input">
                <label for="username">Username:</label>
                <input type="text" id="username" required placeholder="Enter your username">
            </div>
            
            <div class="error" id="error-message"></div>
            <button id="submit-ballot">Submit Ballot</button>
        </div>
    </main>

    <!-- Footer remains the same -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Previous DOM elements and validation functions remain the same
            
            // Add referendum validation
            function validateReferendum() {
                const ref1 = document.getElementById('referendum-1').value.toLowerCase().trim();
                const ref2 = document.getElementById('referendum-2').value.toLowerCase().trim();
                
                if (ref1 !== 'yes' && ref1 !== 'no') {
                    return "Error: Referendum 1 must be either 'yes' or 'no'";
                }
                
                if (ref2 !== 'yes' && ref2 !== 'no') {
                    return "Error: Referendum 2 must be either 'yes' or 'no'";
                }
                
                return '';
            }

            // Update the ballot validation function
            function validateBallot() {
                const validationError = validateBallotPreferences();
                if (validationError) return validationError;
                
                const referendumError = validateReferendum();
                if (referendumError) return referendumError;
                
                if (!usernameInput.value.trim()) return "Error: Please enter your username.";
                
                return '';
            }

            // Rename the original validateBallot to validateBallotPreferences
            function validateBallotPreferences() {
                const inputs = Array.from(document.querySelectorAll('.preference'));
                
                // Count how many preferences are filled
                const filledPreferences = inputs.filter(input => input.value !== "").length;
                if (filledPreferences < 8) return "Error: You must number at least 8 candidates.";
                
                // Validate all filled preferences
                const numbers = inputs
                    .filter(input => input.value !== "")
                    .map(input => parseInt(input.value));
                
                if (numbers.length !== new Set(numbers).size) return "Error: Duplicate numbers detected.";
                
                const invalidNumbers = numbers.filter(n => n < 1);
                if (invalidNumbers.length > 0) return "Error: Preferences must be 1 or higher.";
                
                return '';
            }

            // Update the submission function to include referendum answers
            function submitToGoogleSheet(username, votes) {
                const ref1 = document.getElementById('referendum-1').value.toLowerCase().trim();
                const ref2 = document.getElementById('referendum-2').value.toLowerCase().trim();
                
                const googleScriptUrl = "https://script.google.com/macros/s/AKfycbzdKU25M9DPnZKbAvWsDqpb3tYhgrZk-tNxgl2UuPxowNFzpz5l1H4mU1p97IJ8ACXy/exec";
                
                // Show loading state
                errorMsg.textContent = "Submitting...";
                errorMsg.style.color = "blue";
                submitBtn.disabled = true;
                
                fetch(googleScriptUrl, {
                    method: "POST",
                    mode: "no-cors",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ 
                        username: username.trim(),
                        votes: votes.map(vote => ({
                            candidate: vote.candidate,
                            party: vote.party,
                            preference: vote.value !== "" ? parseInt(vote.value) : 0
                        })),
                        referendum1: ref1,
                        referendum2: ref2
                    })
                })
                .then(() => {
                    errorMsg.textContent = "Ballot submitted successfully!";
                    errorMsg.style.color = "green";
                    
                    // Redirect to a new page after 2 seconds
                    setTimeout(() => {
                        window.location.href = "https://www.kazjistan.org/voting_complete";
                    }, 2000);
                })
                .catch((error) => {
                    errorMsg.textContent = "Error submitting ballot. Please try again.";
                    errorMsg.style.color = "red";
                    submitBtn.disabled = false;
                    console.error("Error:", error);
                });
            }

            // Previous event listeners remain the same
        });
    </script>
</body>
</html>
