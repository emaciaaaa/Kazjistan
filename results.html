<!DOCTYPE html>
<html>
<head>
  <title>Election Results</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    h1, h2 { color: #2c3e50; }
    .card { background: #f9f9f9; padding: 20px; margin: 10px 0; border-radius: 5px; }
    .elected { color: green; font-weight: bold; }
    .eliminated { color: red; text-decoration: line-through; }
    table { width: 100%; border-collapse: collapse; margin: 10px 0; }
    th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
    th { background-color: #3498db; color: white; }
    .round { margin-bottom: 20px; padding: 10px; background: #f0f0f0; }
    .error { color: red; }
    .loading { color: #666; font-style: italic; }
  </style>
</head>
<body>
  <h1>Election Results</h1>
  <div id="results">
    <div class="loading">Loading results...</div>
  </div>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwZ3T_6mT2sEG7FFbmGUcgkIJSEtLgSxSJxMyMrb1O-s4gb1xv0vozcTHkn8pr99yOd/exec';
    
    async function loadResults() {
      try {
        document.getElementById('results').innerHTML = '<div class="loading">Loading results...</div>';
        
        const response = await fetch(SCRIPT_URL);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        
        if (data.error) {
          throw new Error(data.error);
        }
        
        // Display results
        let html = `
          <div class="card">
            <h2>Summary</h2>
            <p>Total Ballots: ${data.totalBallots}</p>
            <p>Quota: ${data.quota}</p>
            <h3>Elected:</h3>
            <ul>${data.elected.map(c => `<li class="elected">${c}</li>`).join('')}</ul>
          </div>
          
          <div class="card">
            <h2>Final Counts</h2>
            <table>
              <tr><th>Candidate</th><th>Votes</th><th>Status</th></tr>
              ${Object.entries(data.finalResults).map(([c, r]) => `
                <tr>
                  <td>${c}</td>
                  <td>${r.votes.toFixed(2)}</td>
                  <td class="${r.status}">${r.status}</td>
                </tr>
              `).join('')}
            </table>
          </div>
          
          <h2>Counting Rounds</h2>
          ${data.rounds.map(round => `
            <div class="round">
              <h3>Round ${round.number}</h3>
              <p><strong>Action:</strong> ${round.action}</p>
              <table>
                <tr><th>Candidate</th><th>Votes</th></tr>
                ${Object.entries(round.counts).map(([c, v]) => `
                  <tr>
                    <td>${c}</td>
                    <td>${v.toFixed(2)}</td>
                  </tr>
                `).join('')}
              </table>
            </div>
          `).join('')}
        `;
        
        document.getElementById('results').innerHTML = html;
        
      } catch (error) {
        document.getElementById('results').innerHTML = `
          <div class="error">
            <h2>Error</h2>
            <p>${error.message}</p>
            <button onclick="loadResults()">Try Again</button>
          </div>
        `;
        console.error("Error loading results:", error);
      }
    }
    
    // Load results when page loads
    window.onload = loadResults;
  </script>
</body>
</html>
