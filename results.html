<!DOCTYPE html>
<html>
<head>
  <title>Live Results</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    .elected { background: #e6f4ea; padding: 10px; border-left: 4px solid #34a853; }
    .round { margin-bottom: 20px; border: 1px solid #eee; padding: 15px; }
    .candidate { display: flex; margin: 5px 0; }
    .candidate-name { flex: 2; }
    .candidate-votes { flex: 1; text-align: right; }
    .winner { font-weight: bold; color: #0d652d; }
  </style>
</head>
<body>
  <h1>Kazjistan Parliamentary Election Results</h1>
  
  <div id="summary">
    <p>Last updated: <span id="timestamp"></span></p>
    <p>Quota: <span id="quota"></span> votes</p>
  </div>
  
  <h2>Elected Candidates</h2>
  <div id="elected"></div>
  
  <h2>Round-by-Round Results</h2>
  <div id="rounds"></div>
  
  <script>
    function displayResults(data) {
      // Update metadata
      document.getElementById('timestamp').textContent = data.lastUpdated;
      document.getElementById('quota').textContent = data.quota;
      
      // Show elected candidates
      const electedDiv = document.getElementById('elected');
      electedDiv.innerHTML = data.elected.map(c => 
        `<div class="elected">${c}</div>`
      ).join('');
      
      // Show round details
      const roundsDiv = document.getElementById('rounds');
      roundsDiv.innerHTML = data.rounds.map(round => `
        <div class="round">
          <h3>Round ${round.number}</h3>
          ${Object.entries(round.counts)
            .sort((a, b) => b[1] - a[1])
            .map(([candidate, votes]) => `
              <div class="candidate ${round.winners.includes(candidate) ? 'winner' : ''}">
                <span class="candidate-name">${candidate}</span>
                <span class="candidate-votes">${votes} votes</span>
              </div>`
            ).join('')}
          ${round.winners.length > 0 ? 
            `<p>Elected: ${round.winners.join(', ')}</p>` : 
            `<p>Lowest candidate eliminated</p>`}
        </div>`
      ).join('');
    }
    
    function loadResults() {
      google.script.run
        .withSuccessHandler(displayResults)
        .withFailureHandler(error => {
          console.error("Error:", error);
          document.getElementById('timestamp').textContent = "Error loading results";
        })
        .getLiveResults();
    }
    
    // Load now and refresh every 30 seconds
    loadResults();
    setInterval(loadResults, 30000);
  </script>
</body>
</html>
